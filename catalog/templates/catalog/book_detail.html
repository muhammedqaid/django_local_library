{% extends "base_generic.html" %}

{% block content %}
    <h1>Title: {{ book.title }}</h1>
    
    <p><strong>Author:</strong> <a href="{{ book.author.get_absolute_url }}">{{ book.author }}</a></p> <!-- author detail link not yet defined -->
    <p><strong>Summary:</strong> {{ book.summary }}</p>
    <p><strong>ISBN:</strong> {{ book.isbn }}</p>
    <p><strong>Language:</strong> {{ book.language }}</p>
    <p><strong>Genre:</strong> {{ book.genre.all|join:", " }}</p>
    
    {% if perms.catalog.update_books %}
        <p><a href="{% url 'book-update' book.id %}">Update</a></p>
        {# So cannot delete if instances remain #}
        {% if not book.bookinstance_set.all %}
            <p><a href="{% url 'book-delete' book.id %}">Delete</a></p>
        {% endif %}
    {% endif %}
    

    <div style="margin-left:20px;margin-top:20px">
        <h4>Copies</h4>

        <!--
            Needed as we declare a forgein key (one-to-many) field only in the "many" side (i.e Instances side)
            So, the book doesn't have any field to get the set of associated records (instances)
            SO, Django constructs an appropriately named reverse lookup. 
            The function is constructed by lower-casing the model name where the Fk was declared followed by _set
                - E.g. bookinstance_set()
        -->
        <!--
            NEED TO DEFINE AN ORDER (on class-based view or model)
            Because 'paginator object' expects to see some ORDER BY executed on underlying DB
            So need to pick from: 
                1. Add ordering inclide class Meta of model
                2. Add queryset attribute in custom class-based view, specifying an order_by()
                3. Adding get_queryset method to your custom class-based view and also specify the order_by()

        -->
        <!--
            Shoud sort by attribute with an index (on db) to avoid performance issues  
        -->
        {% for copy in book.bookinstance_set.all %}
            <hr>
            <p class="{% if copy.status == 'a' %}text-success{% elif copy.status == 'm' %}text-danger{% else %}text-warning{% endif %}">
                {{ copy.get_status_display }}
                <!-- Autogenerated method for choice fields (BookInstance.status) -->
            </p>
            {% if copy.status != 'a' %}
                <p><strong>Due to be returned:</strong> {{ copy.due_back }}</p>
            {% endif %}
            <p><strong>Imprint:</strong> {{ copy.imprint }}</p>
            <p class="text-muted"><strong>Id:</strong> {{ copy.id }}</p>
        {% endfor %}
    </div>
{% endblock %}
